<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>FaceNormalShader.as</title>
<link rel="stylesheet" type="text/css" href="../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span> 
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">arcane</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">cameras</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lenses</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">containers</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">base</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">render</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">session</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">vos</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lights</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;
    
    <span class="ActionScriptReserved">use</span> <span class="ActionScriptReserved">namespace</span> <span class="ActionScriptDefault_Text">arcane</span>;
    
    <span class="ActionScriptASDoc">/**
     * @author robbateman
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">FaceNormalShader</span> 
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_session</span>:<span class="ActionScriptDefault_Text">AbstractSession</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">persp</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v0x</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v0y</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v0z</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v1x</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v1y</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v1z</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v2x</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v2y</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v2z</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d1x</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d1y</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d1z</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d2x</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d2y</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d2z</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pa</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pb</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pc</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pdd</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">c0x</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">c0y</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">c0z</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">kar</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">kag</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">kab</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">kdr</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">kdg</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">kdb</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ksr</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ksg</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ksb</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">red</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">green</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">blue</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dfx</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dfy</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dfz</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">df</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nx</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ny</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nz</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fade</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">amb</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nf</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">diff</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rfx</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rfy</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rfz</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">spec</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rf</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">graphics</span>:<span class="ActionScriptDefault_Text">Graphics</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cz</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cx</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cy</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ncz</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ncx</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ncy</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sum</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ffz</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ffx</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ffy</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fz</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fx</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fy</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rz</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rx</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ry</span>:<span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">draw_normal</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">draw_fall</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">draw_fall_k</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 1;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">draw_reflect</span>:<span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">draw_reflect_k</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 1;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_diffuseTransform</span>:<span class="ActionScriptDefault_Text">Matrix3D</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_specularTransform</span>:<span class="ActionScriptDefault_Text">Matrix3D</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_viewPosition</span>:<span class="ActionScriptDefault_Text">Vector3D</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_normal</span>:<span class="ActionScriptDefault_Text">Vector3D</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_source</span>:<span class="ActionScriptDefault_Text">Mesh</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_view</span>:<span class="ActionScriptDefault_Text">View3D</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_lens</span>:<span class="ActionScriptDefault_Text">AbstractLens</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_startIndex</span>:<span class="ActionScriptDefault_Text">uint</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_endIndex</span>:<span class="ActionScriptDefault_Text">uint</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_faceVO</span>:<span class="ActionScriptDefault_Text">FaceVO</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_screenVertices</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_screenIndices</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">&gt;</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_screenUVTs</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">&gt;</span>;
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getTriangleShade</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">priIndex</span>:<span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">viewSourceObject</span>:<span class="ActionScriptDefault_Text">ViewSourceObject</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">renderer</span>:<span class="ActionScriptDefault_Text">Renderer</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">shininess</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">FaceNormalShaderVO</span>
        <span class="ActionScriptBracket/Brace">{</span>        
            <span class="ActionScriptDefault_Text">_source</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">viewSourceObject</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">source</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Mesh</span>;
            <span class="ActionScriptDefault_Text">_view</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">renderer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_view</span>;
            <span class="ActionScriptDefault_Text">_lens</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_view</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">camera</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lens</span>;
            <span class="ActionScriptDefault_Text">_session</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">renderer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_session</span>;
            
            <span class="ActionScriptDefault_Text">_startIndex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">renderer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">primitiveProperties</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">priIndex</span><span class="ActionScriptOperator">*</span>9<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">_endIndex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">renderer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">primitiveProperties</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">priIndex</span><span class="ActionScriptOperator">*</span>9 <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">_faceVO</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">renderer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">primitiveElements</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">priIndex</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">FaceVO</span>;
            
            <span class="ActionScriptDefault_Text">_screenVertices</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">viewSourceObject</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">screenVertices</span>;
            <span class="ActionScriptDefault_Text">_screenIndices</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">viewSourceObject</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">screenIndices</span>;
            <span class="ActionScriptDefault_Text">_screenUVTs</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">viewSourceObject</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">screenUVTs</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">indexA</span>:<span class="ActionScriptDefault_Text">uint</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">indexB</span>:<span class="ActionScriptDefault_Text">uint</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">indexC</span>:<span class="ActionScriptDefault_Text">uint</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_endIndex</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_startIndex</span> <span class="ActionScriptOperator">&gt;</span> 10<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">indexA</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_screenIndices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_startIndex</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">indexB</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_screenIndices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_startIndex</span> <span class="ActionScriptOperator">+</span> 5<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">indexC</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_screenIndices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_startIndex</span> <span class="ActionScriptOperator">+</span> 9<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">indexA</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_screenIndices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_startIndex</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">indexB</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_screenIndices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_startIndex</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">indexC</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_screenIndices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_startIndex</span> <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">v0z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_lens</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getScreenZ</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_screenUVTs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">indexA</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">persp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_lens</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getPerspective</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v0z</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">v0x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_screenVertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">indexA</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">persp</span>;
            <span class="ActionScriptDefault_Text">v0y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_screenVertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">indexA</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">persp</span>;
            
            <span class="ActionScriptDefault_Text">v1z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_lens</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getScreenZ</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_screenUVTs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">indexB</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">persp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_lens</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getPerspective</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v1z</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">v1x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_screenVertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">indexB</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">persp</span>;
            <span class="ActionScriptDefault_Text">v1y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_screenVertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">indexB</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">persp</span>;
            
            <span class="ActionScriptDefault_Text">v2z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_lens</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getScreenZ</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_screenUVTs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">indexC</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">persp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_lens</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getPerspective</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v2z</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">v2x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_screenVertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">indexC</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">persp</span>;
            <span class="ActionScriptDefault_Text">v2y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_screenVertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">indexC</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">persp</span>;
            
            <span class="ActionScriptDefault_Text">d1x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">v1x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">v0x</span>;
            <span class="ActionScriptDefault_Text">d1y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">v1y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">v0y</span>;
            <span class="ActionScriptDefault_Text">d1z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">v1z</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">v0z</span>;
            
            <span class="ActionScriptDefault_Text">d2x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">v2x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">v0x</span>;
            <span class="ActionScriptDefault_Text">d2y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">v2y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">v0y</span>;
            <span class="ActionScriptDefault_Text">d2z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">v2z</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">v0z</span>;
            
            <span class="ActionScriptDefault_Text">pa</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d1y</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">d2z</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">d1z</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">d2y</span>;
            <span class="ActionScriptDefault_Text">pb</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d1z</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">d2x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">d1x</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">d2z</span>;
            <span class="ActionScriptDefault_Text">pc</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d1x</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">d2y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">d1y</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">d2x</span>;
            <span class="ActionScriptDefault_Text">pdd</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sqrt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pa</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pa</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">pb</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pb</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">pc</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pc</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">pa</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">pdd</span>;
            <span class="ActionScriptDefault_Text">pb</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">pdd</span>;
            <span class="ActionScriptDefault_Text">pc</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">pdd</span>;
            
            <span class="ActionScriptDefault_Text">c0x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v0x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">v1x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">v2x</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> 3;
            <span class="ActionScriptDefault_Text">c0y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v0y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">v1y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">v2y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> 3;
            <span class="ActionScriptDefault_Text">c0z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v0z</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">v1z</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">v2z</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> 3;
            
            <span class="ActionScriptDefault_Text">kar</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">kag</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">kab</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">kdr</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">kdg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">kdb</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ksr</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ksg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ksb</span> <span class="ActionScriptOperator">=</span> 0;

            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">directional</span>:<span class="ActionScriptDefault_Text">DirectionalLight3D</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_tri_scene_directionalLights</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">DirectionalLight3D</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_source</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">scene</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">directionalLights</span>;
            <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">directional</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_tri_scene_directionalLights</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_diffuseTransform</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">directional</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">diffuseTransform</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_source</span><span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptDefault_Text">red</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">directional</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_red</span>;
                <span class="ActionScriptDefault_Text">green</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">directional</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_green</span>;
                <span class="ActionScriptDefault_Text">blue</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">directional</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_blue</span>;
                
                <span class="ActionScriptDefault_Text">dfx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_diffuseTransform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">dfy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_diffuseTransform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>6<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">dfz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_diffuseTransform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>10<span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptDefault_Text">_normal</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_faceVO</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">face</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getFaceNormal</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_faceVO</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">face</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">nx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_normal</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptDefault_Text">ny</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_normal</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span>;
                <span class="ActionScriptDefault_Text">nz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_normal</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span>;
                
                <span class="ActionScriptDefault_Text">amb</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">directional</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ambient</span>;
                
                <span class="ActionScriptDefault_Text">kar</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">red</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">amb</span>;
                <span class="ActionScriptDefault_Text">kag</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">green</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">amb</span>;
                <span class="ActionScriptDefault_Text">kab</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">blue</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">amb</span>;
                
                <span class="ActionScriptDefault_Text">nf</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dfx</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">nx</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dfy</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">ny</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dfz</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">nz</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nf</span> <span class="ActionScriptOperator">&lt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptReserved">continue</span>;
                
                <span class="ActionScriptDefault_Text">diff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">directional</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">diffuse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">nf</span>;
                
                <span class="ActionScriptDefault_Text">kdr</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">red</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">diff</span>;
                <span class="ActionScriptDefault_Text">kdg</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">green</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">diff</span>;
                <span class="ActionScriptDefault_Text">kdb</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">blue</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">diff</span>;
                
                <span class="ActionScriptDefault_Text">_specularTransform</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">directional</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">specularTransform</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_source</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_view</span><span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptDefault_Text">rfx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_specularTransform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">rfy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_specularTransform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>6<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">rfz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_specularTransform</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>10<span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptDefault_Text">rf</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">rfx</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">nx</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">rfy</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">ny</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">rfz</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">nz</span>;
                
                <span class="ActionScriptDefault_Text">spec</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">directional</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">specular</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pow</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rf</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">shininess</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">ksr</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">red</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">spec</span>;
                <span class="ActionScriptDefault_Text">ksg</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">green</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">spec</span>;
                <span class="ActionScriptDefault_Text">ksb</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">blue</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">spec</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_tri_scene_pointLights</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">PointLight3D</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_source</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">scene</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pointLights</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">point</span>:<span class="ActionScriptDefault_Text">PointLight3D</span>;
            
            <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">point</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_tri_scene_pointLights</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">red</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_red</span>;
                <span class="ActionScriptDefault_Text">green</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_green</span>;
                <span class="ActionScriptDefault_Text">blue</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_blue</span>;
                
                <span class="ActionScriptDefault_Text">_viewPosition</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">viewPositions</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_view</span><span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptDefault_Text">dfx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewPosition</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">c0x</span>;
                <span class="ActionScriptDefault_Text">dfy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewPosition</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">c0y</span>;
                <span class="ActionScriptDefault_Text">dfz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewPosition</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">c0z</span>;
                <span class="ActionScriptDefault_Text">df</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sqrt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dfx</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfx</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dfy</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfy</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dfz</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfz</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">dfx</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">df</span>;
                <span class="ActionScriptDefault_Text">dfy</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">df</span>;
                <span class="ActionScriptDefault_Text">dfz</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">df</span>;
                <span class="ActionScriptDefault_Text">fade</span> <span class="ActionScriptOperator">=</span> 1 <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">df</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">df</span>;
                
                <span class="ActionScriptDefault_Text">amb</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ambient</span>;
                
                <span class="ActionScriptDefault_Text">kar</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">red</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">amb</span>;
                <span class="ActionScriptDefault_Text">kag</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">green</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">amb</span>;
                <span class="ActionScriptDefault_Text">kab</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">blue</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">amb</span>;
                
                <span class="ActionScriptDefault_Text">nf</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dfx</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pa</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dfy</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pb</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dfz</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pc</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nf</span> <span class="ActionScriptOperator">&lt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptReserved">continue</span>;
                
                <span class="ActionScriptDefault_Text">diff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">diffuse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">brightness</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">fade</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">nf</span> <span class="ActionScriptOperator">*</span> 250000;
                
                <span class="ActionScriptDefault_Text">kdr</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">red</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">diff</span>;
                <span class="ActionScriptDefault_Text">kdg</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">green</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">diff</span>;
                <span class="ActionScriptDefault_Text">kdb</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">blue</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">diff</span>;
                
                <span class="ActionScriptDefault_Text">rfz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dfz</span> <span class="ActionScriptOperator">-</span> 2<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">nf</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pc</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rfz</span> <span class="ActionScriptOperator">&lt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptReserved">continue</span>;
                
                <span class="ActionScriptDefault_Text">rfx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dfx</span> <span class="ActionScriptOperator">-</span> 2<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">nf</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pa</span>;
                <span class="ActionScriptDefault_Text">rfy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dfy</span> <span class="ActionScriptOperator">-</span> 2<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">nf</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pb</span>;
                
                <span class="ActionScriptDefault_Text">spec</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">specular</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">brightness</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">fade</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pow</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rfz</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">shininess</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 250000;
                
                <span class="ActionScriptDefault_Text">ksr</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">red</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">spec</span>;
                <span class="ActionScriptDefault_Text">ksg</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">green</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">spec</span>;
                <span class="ActionScriptDefault_Text">ksb</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">blue</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">spec</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">draw_fall</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">draw_reflect</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">draw_normal</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">graphics</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_session</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">graphics</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">cz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_lens</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getPerspective</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0z</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">cx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c0x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cz</span><span class="ActionScriptOperator">,</span>
                <span class="ActionScriptDefault_Text">cy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c0y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">cz</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">draw_normal</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">ncz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_lens</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getPerspective</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0z</span> <span class="ActionScriptOperator">+</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pc</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span>
                    <span class="ActionScriptDefault_Text">ncx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0x</span> <span class="ActionScriptOperator">+</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pa</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ncz</span><span class="ActionScriptOperator">,</span>
                    <span class="ActionScriptDefault_Text">ncy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0y</span> <span class="ActionScriptOperator">+</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pb</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ncz</span>;
                    
                    <span class="ActionScriptDefault_Text">graphics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">,</span> 0x000000<span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">graphics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">moveTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cx</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">cy</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">graphics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lineTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ncx</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">ncy</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">graphics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">moveTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cx</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">cy</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">graphics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">drawCircle</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cx</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">cy</span><span class="ActionScriptOperator">,</span> 2<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">draw_fall</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">draw_reflect</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_tri_source_scene_pointLights_new</span>:<span class="ActionScriptDefault_Text">Vector</span><span class="ActionScriptBracket/Brace">.&lt;</span><span class="ActionScriptDefault_Text">PointLight3D</span><span class="ActionScriptBracket/Brace">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_source</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">scene</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">pointLights</span>;
                    <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">point</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_tri_source_scene_pointLights_new</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">red</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_red</span>;
                        <span class="ActionScriptDefault_Text">green</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_green</span>;
                        <span class="ActionScriptDefault_Text">blue</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_blue</span>;
                        <span class="ActionScriptDefault_Text">sum</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">red</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">green</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">blue</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> 0xFF;
                        <span class="ActionScriptDefault_Text">red</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">sum</span>;
                        <span class="ActionScriptDefault_Text">green</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">sum</span>;
                        <span class="ActionScriptDefault_Text">blue</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">sum</span>;
                        
                        <span class="ActionScriptDefault_Text">dfx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewPosition</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">c0x</span>;
                        <span class="ActionScriptDefault_Text">dfy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewPosition</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">c0y</span>;
                        <span class="ActionScriptDefault_Text">dfz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewPosition</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">c0z</span>;
                        <span class="ActionScriptDefault_Text">df</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sqrt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dfx</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfx</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dfy</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfy</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dfz</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfz</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">dfx</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">df</span>;
                        <span class="ActionScriptDefault_Text">dfy</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">df</span>;
                        <span class="ActionScriptDefault_Text">dfz</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">df</span>;
                        
                        <span class="ActionScriptDefault_Text">nf</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dfx</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pa</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dfy</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pb</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dfz</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pc</span>;
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nf</span> <span class="ActionScriptOperator">&lt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptReserved">continue</span>;
                        
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">draw_fall</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">ffz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_lens</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getPerspective</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0z</span> <span class="ActionScriptOperator">+</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfz</span><span class="ActionScriptOperator">*</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">draw_fall_k</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span>
                            <span class="ActionScriptDefault_Text">ffx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0x</span> <span class="ActionScriptOperator">+</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfx</span><span class="ActionScriptOperator">*</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">draw_fall_k</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ffz</span><span class="ActionScriptOperator">,</span>
                            <span class="ActionScriptDefault_Text">ffy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0y</span> <span class="ActionScriptOperator">+</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfy</span><span class="ActionScriptOperator">*</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">draw_fall_k</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ffz</span><span class="ActionScriptOperator">,</span>
                            
                            <span class="ActionScriptDefault_Text">fz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_lens</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getPerspective</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0z</span> <span class="ActionScriptOperator">+</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfz</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span>
                            <span class="ActionScriptDefault_Text">fx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0x</span> <span class="ActionScriptOperator">+</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfx</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">fz</span><span class="ActionScriptOperator">,</span>
                            <span class="ActionScriptDefault_Text">fy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0y</span> <span class="ActionScriptOperator">+</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfy</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">fz</span>;
                            
                            <span class="ActionScriptDefault_Text">graphics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">red</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span>0x10000 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">green</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span>0x100 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">blue</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">graphics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">moveTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ffx</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">ffy</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">graphics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lineTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fx</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">fy</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">graphics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">moveTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ffx</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">ffy</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>

                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">draw_reflect</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">rfx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dfx</span> <span class="ActionScriptOperator">-</span> 2<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">nf</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pa</span>;
                            <span class="ActionScriptDefault_Text">rfy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dfy</span> <span class="ActionScriptOperator">-</span> 2<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">nf</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pb</span>;
                            <span class="ActionScriptDefault_Text">rfz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dfz</span> <span class="ActionScriptOperator">-</span> 2<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">nf</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pc</span>;
                            
                            <span class="ActionScriptDefault_Text">rz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_lens</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getPerspective</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0z</span> <span class="ActionScriptOperator">-</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">rfz</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">draw_reflect_k</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span>
                            <span class="ActionScriptDefault_Text">rx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0x</span> <span class="ActionScriptOperator">-</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">rfx</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">draw_reflect_k</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rz</span><span class="ActionScriptOperator">,</span>
                            <span class="ActionScriptDefault_Text">ry</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0y</span> <span class="ActionScriptOperator">-</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">rfy</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">draw_reflect_k</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">rz</span>;
                            
                            <span class="ActionScriptDefault_Text">graphics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">red</span><span class="ActionScriptOperator">*</span>0.5<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span>0x10000 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">green</span><span class="ActionScriptOperator">*</span>0.5<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span>0x100 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">blue</span><span class="ActionScriptOperator">*</span>0.5<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">,</span> 1<span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">graphics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">moveTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cx</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">cy</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">graphics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lineTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rx</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">ry</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">graphics</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">moveTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cx</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">cy</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">FaceNormalShaderVO</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">kar</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">kag</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">kab</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">kdr</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">kdg</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">kdb</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">ksr</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">ksg</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">ksb</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span>
</pre></body>
</html>
