<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>CollisionMap.as</title>
<link rel="stylesheet" type="text/css" href="../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">away3d</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">extrusions</span><span class="ActionScriptBracket/Brace">{</span>       <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">display</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">BitmapData</span>;    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptOperator">*</span>;    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">CollisionMap</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">EventDispatcher</span><span class="ActionScriptBracket/Brace">{</span>                <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_detectBmd</span>:<span class="ActionScriptDefault_Text">BitmapData</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_oDetect</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> {};        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_factorX</span>:<span class="ActionScriptDefault_Text">Number</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_factorY</span>:<span class="ActionScriptDefault_Text">Number</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_offsetX</span>:<span class="ActionScriptDefault_Text">Number</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_offsetY</span>:<span class="ActionScriptDefault_Text">Number</span>;                <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">fireColorEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">eventID</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">eventID</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptASDoc">/**         * Creates a new &lt;code&gt;CollisionMap&lt;/code&gt;         *          * @param         sourcebmd        The bitmapdata with color regions to act as trigger.         * @param     factorX            [optional]    A factor scale along the X axis         * @param     factorY            [optional]    A factor scale along the Y axis         *          * note that an offset equal to halfwidth/halfheight of the source is set per default. Because most terrains are placed centered at 0,0,0          */</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">CollisionMap</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sourcebmd</span>:<span class="ActionScriptDefault_Text">BitmapData</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">factorX</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0 <span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">factorY</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0<span class="ActionScriptBracket/Brace">)</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_detectBmd</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sourcebmd</span>;            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_factorX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">factorX</span>;            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_factorY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">factorY</span>;            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_offsetX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sourcebmd</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rect</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">*</span>.5;            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_offsetY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sourcebmd</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rect</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">height</span><span class="ActionScriptOperator">*</span>.5;         <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptASDoc">/**         * If at the given coordinates a color is found that matches a defined color event, the color event will be triggered.         *          * @param     x            X coordinate on the source bmd         * @param     y            Y coordinate on the source bmd         *         * note that offsetX, offsetY, factorX, factorY are applied in this handler         */</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">read</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">x</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">y</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">col</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">_factorX</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">row</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">_factorY</span>;             <span class="ActionScriptDefault_Text">col</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_offsetX</span>;            <span class="ActionScriptDefault_Text">row</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_offsetY</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">color</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_detectBmd</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getPixel</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">col</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">row</span><span class="ActionScriptBracket/Brace">)</span>;                        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_oDetect</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">"_"</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">color</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">{</span>                <span class="ActionScriptDefault_Text">fireColorEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_oDetect</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">"_"</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">color</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">eventID</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptBracket/Brace">}</span>                     <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptASDoc">/**         * If at the given coordinates a color is found that matches a defined color event, the color event will be triggered.         *          * @param     x            X coordinate on the source bmd         * @param     y            Y coordinate on the source bmd         *         * @return        A Number, the color value at coordinates x, y         *         * note that offsetX, offsetY, factorX, factorY are applied in this handler         */</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getColorAt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">x</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">y</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">col</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">_factorX</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">row</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">_factorY</span>;             <span class="ActionScriptDefault_Text">col</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_offsetX</span>;            <span class="ActionScriptDefault_Text">row</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_offsetY</span>;                        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_detectBmd</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getPixel</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">col</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">row</span><span class="ActionScriptBracket/Brace">)</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptASDoc">/**         * Defines a color event for this class         *          * @param     color            A color Number         * @param     eventid        A string to identify that event         * @param     listener        The function  that must be triggered         *         * note that offsetX, offsetY, factorX, factorY are applied in this handler         */</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setColorEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">color</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">eventid</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">listener</span>:<span class="ActionScriptDefault_Text">Function</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptDefault_Text">_oDetect</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">"_"</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">color</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">{</span><span class="ActionScriptDefault_Text">color</span>:<span class="ActionScriptDefault_Text">color</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">eventID</span>:<span class="ActionScriptDefault_Text">eventid</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">min</span>:<span class="ActionScriptDefault_Text">color</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">max</span>:<span class="ActionScriptDefault_Text">color</span><span class="ActionScriptBracket/Brace">}</span>;            <span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">eventid</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">listener</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptOperator">,</span> 0<span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptASDoc">/**         * getter/setter for the offsetX, offsetY         */</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">offsetX</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">val</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptDefault_Text">_offsetX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">val</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">offsetY</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">val</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptDefault_Text">_offsetY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">val</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">offsetX</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_offsetX</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">offsetY</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_offsetY</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptASDoc">/**         * getter/setter for the factorX, factorY         */</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">factorX</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">val</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptDefault_Text">_factorX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">val</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">factorY</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">val</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptDefault_Text">_factorY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">val</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">factorX</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_factorX</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">factorY</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_factorY</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptASDoc">/**         * getter/setter for source bitmapdata         */</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">source</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bmd</span>:<span class="ActionScriptDefault_Text">BitmapData</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_detectBmd</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bmd</span>;        <span class="ActionScriptBracket/Brace">}</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">source</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">BitmapData</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">this</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_detectBmd</span>;        <span class="ActionScriptBracket/Brace">}</span>             <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
